// automatically generated by ECSS
grammar trglang.com.temenos.interaction.rimdsl.RIMDsl with org.eclipse.xtext.common.Terminals

import "http://www.com.trglang/temenos/interaction/rimdsl/RIMDsl" 
import "http://www.eclipse.org/emf/2002/Ecore" as ecore

DomainModel:
	{DomainModel} "DomainModel" "{" (rims+=Ref ("," rims+=Ref)*)? "}";

Ref:
	DomainDeclaration | ResourceInteractionModel | Use;

Use:
	{Use} "Use" "{" importedNamespace=ESTRING? "}";

ResourceInteractionModel:
	{ResourceInteractionModel} "ResourceInteractionModel" name=IDDT? "{" (annotations+=MdfAnnotation (","
	annotations+=MdfAnnotation)*)? (events+=Event ("," events+=Event)*)? (commands+=Command ("," commands+=Command)*)?
	basepath=BasePath? (relations+=Relation ("," relations+=Relation)*)? (states+=State ("," states+=State)*)? "}";

DomainDeclaration:
	{DomainDeclaration} "DomainDeclaration" name=IDDT? "{" (annotations+=MdfAnnotation ("," annotations+=MdfAnnotation)*)?
	(rims+=Ref ("," rims+=Ref)*)? "}";

MdfAnnotation:
	{MdfAnnotation} "MdfAnnotation" name=IDDT? "{" namespace=ESTRING? (properties+=ESTRING ("," properties+=ESTRING)*)?
	"}";

BasePath:
	{BasePath} "BasePath" name=IDDT? "{" "}";

Event:
	{Event} "Event" name=IDDT? "{" (annotations+=MdfAnnotation ("," annotations+=MdfAnnotation)*)? httpMethod=ESTRING?
	"}";

Command:
	{Command} "Command" name=IDDT? "{" spec=CommandSpec? "}";

State:
	{State} "State" name=IDDT? "{" isInitial?=EBOOLEAN? isException?=EBOOLEAN? (annotations+=MdfAnnotation (","
	annotations+=MdfAnnotation)*)? type=ResourceType? entity=Entity? impl=ImplRef? (relations+=RelationRef (","
	relations+=RelationRef)*)? path=Path? (transitions+=TransitionRef ("," transitions+=TransitionRef)*)?
	errorState=[State|IDDT]? cache=EINT? "}";

Relation:
	{Relation} "Relation" name=IDDT? "{" fqn=ESTRING? description=ESTRING? "}";

terminal ESTRING:
	"\"" ("\\" . | !("\\" | "\""))* "\"" | "\'" ("\\" . | !("\\" | "\'"))* "\'";

CommandSpec:
	{CommandSpec} "CommandSpec" "{" (properties+=CommandProperty ("," properties+=CommandProperty)*)? "}";

RelationRef:
	RelationConstant;

ResourceType:
	{ResourceType} "ResourceType" "{" isCollection?=EBOOLEAN? isItem?=EBOOLEAN? "}";

terminal EBOOLEAN returns ecore::EBoolean:
	"true" | "false";

TransitionRef:
	Transition | TransitionEmbeddedForEach | TransitionEmbedded | TransitionForEach | TransitionRedirect | TransitionAuto;

Entity:
	{Entity} "Entity" name=IDDT? "{" "}";

Path:
	{Path} "Path" name=IDDT? "{" "}";

terminal EINT returns ecore::EInt:
	"0".."9"+;

ImplRef:
	{ImplRef} "ImplRef" "{" view=ResourceCommand? (actions+=ResourceCommand ("," actions+=ResourceCommand)*)?
	(methods+=MethodRef ("," methods+=MethodRef)*)? "}";

CommandProperty:
	{CommandProperty} "CommandProperty" name=IDDT? "{" value=ESTRING? "}";

RelationConstant:
	{RelationConstant} "RelationConstant" name=IDDT? "{" relation=[Relation|IDDT]? "}";

TransitionEmbedded:
	{TransitionEmbedded} "TransitionEmbedded" name=IDDT? "{" event=[Event|IDDT]? state=[State|IDDT]?
	locator=ResourceLocator? spec=TransitionSpec? "}";

TransitionForEach:
	{TransitionForEach} "TransitionForEach" name=IDDT? "{" event=[Event|IDDT]? state=[State|IDDT]?
	locator=ResourceLocator? spec=TransitionSpec? "}";

TransitionRedirect:
	{TransitionRedirect} "TransitionRedirect" name=IDDT? "{" event=[Event|IDDT]? state=[State|IDDT]?
	locator=ResourceLocator? spec=TransitionSpec? "}";

TransitionAuto:
	{TransitionAuto} "TransitionAuto" name=IDDT? "{" event=[Event|IDDT]? state=[State|IDDT]? locator=ResourceLocator?
	spec=TransitionSpec? "}";

Transition:
	{Transition} "Transition" name=IDDT? "{" event=[Event|IDDT]? state=[State|IDDT]? locator=ResourceLocator?
	spec=TransitionSpec? "}";

TransitionEmbeddedForEach:
	{TransitionEmbeddedForEach} "TransitionEmbeddedForEach" name=IDDT? "{" event=[Event|IDDT]? state=[State|IDDT]?
	locator=ResourceLocator? spec=TransitionSpec? "}";

ResourceCommand:
	{ResourceCommand} "ResourceCommand" "{" command=[Command|IDDT]? (properties+=CommandProperty (","
	properties+=CommandProperty)*)? "}";

MethodRef:
	{MethodRef} "MethodRef" "{" event=[Event|IDDT]? command=ResourceCommand? "}";

ResourceLocator:
	{ResourceLocator} "ResourceLocator" name=IDDT? "{" (args+=ESTRING ("," args+=ESTRING)*)? "}";

TransitionSpec:
	{TransitionSpec} "TransitionSpec" "{" eval=Expression? (uriLinks+=UriLink ("," uriLinks+=UriLink)*)? title=Title?
	id=LinkId? field=SourceField? "}";

UriLink:
	{UriLink} "UriLink" "{" templateProperty=ESTRING? entityProperty=UriLinkage? "}";

SourceField:
	{SourceField} "SourceField" name=IDDT? "{" "}";

LinkId:
	{LinkId} "LinkId" name=IDDT? "{" "}";

Title:
	{Title} "Title" name=IDDT? "{" "}";

Expression:
	{Expression} "Expression" "{" (expressions+=Function ("," expressions+=Function)*)? "}";

UriLinkage:
	{UriLinkage} "UriLinkage" name=IDDT? "{" "}";

Function:
	Function_OK | Function_NOT_FOUND;

Function_OK:
	OKFunction;

Function_NOT_FOUND:
	NotFoundFunction;

NotFoundFunction:
	{NotFoundFunction} "NotFoundFunction" "{" state=[State|IDDT]? "}";

OKFunction:
	{OKFunction} "OKFunction" "{" state=[State|IDDT]? "}";

IDDT:
	EBOOLEAN | ID;

terminal ID:
	"^"? ("a".."z" | "A".."Z" | "_") ("a".."z" | "A".."Z" | "_" | "0".."9")*;